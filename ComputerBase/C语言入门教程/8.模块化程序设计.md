##一、前言
我们现在已经能够编写很多简单的c语言程序了，但是如果程序的功能比较多的话，规模比较大，把所有的程序代码都写在一个主函数（main函数）中，就会使主函数变得庞杂，阅读和维护都会很困难。此外，有时程序需要多次实现某一个功能，就需要多次编写实现此功能的程序代码。这使得程序变得冗杂，不精练。

所以一个较为复杂的程序系统往往需要若干个子系统。然后对这些子系统分别进行开发和调试。高级语言中的子程序就是用来实现这种模块划分的。c语言的子系统具体体现就是函数，通常将相对独立经常使用的功能抽象为函数。函数编写完成以后可以重复使用，使用时只需要关心程序的功能而不必关心函数功能的具体实现。这样有利于代码重用，可以提高开发效率，也便于分工合作以及修改维护。这就是模块化程序设计。

一个c语言程序可由一个主函数和若干其它函数构成，每个函数实现一个特定的功能。主函数调用其他函数，其它函数也可以互相调用。同一个函数可以被一个或者多个函数调用多次。下图是一个程序中函数调用的示意图。

![Alt text](https://dn-anything-about-doc.qbox.me/c/9-1.png)

**我们通过9-1的例子来理解模块化程序设计**
输出一下结果,要求用函数调用实现

```
*************
how do you do!
*************
```

**解题思路：**在输出的文字上下分别有一行“\*”号，显然不必重复写这段代码，用一个函数printstar来实现输出一行“\*”的功能。再写一个print_message函数来输出中间一行文字信息，用主函数分别调用这两个函数即可。
编写如下：

![Alt text](https://dn-anything-about-doc.qbox.me/c/9-2.png)

**运行结果：**

![Alt text](https://dn-anything-about-doc.qbox.me/c/9-3.png)


**程序分析**：printstar和print_message都是用户自定义的函数名，分别用来输出一排“*”号和一行文字信息。在定义这两个函数时指定函数的类型为void，表示函数无类型，即无函数值，也就是说，执行这两个函数不会带任何值到main函数。

在程序中，定义printstar和print\_message函数的位置是在main函数后面，在这种情况下，应该在main函数之前或main函数中的开头部分，对以上两个函数进行“声明”。函数声明的作用是把有关函数的信息（函数名、函数类型、函数参数的个数与类型）通知编译系统，以便于在编译系统对程序进行编译时，在进行到main函数调用printstar和print\_message时知道他们是函数而不是变量或其他对象。

###函数的分类
####用户使用角度分类
（1）库函数。它是由系统提供的，用户不必去定义，可以直接使用它。比如printf（）函数、puts（）函数等等。

（2）用户自定义函数。比如上例中的printstar（）函数和print_message（）函数。

####函数的形式角度分类
（1）无参函数。上例中的printstar和print_message都是无参函数。在调用无参函数的时候，主调函数不向被调函数传递数据。无参函数一般用来执行指定的一组操作，比如printstar就是输出一行“*”。无参函数可以带回也可以不带回函数值。

（2）有参函数。在调用函数时，主调函数通过参数向被调函数传输数据，例如上一节的strlen（）函数就是有参函数，主函数传递一个字符串到strlen（）函数，strlen返回值是这个字符串的长度。



###本节目标
我们本节课将要讲述以下内容：
+ 函数的定义
+ 函数的嵌套调用
+ 递归函数
+ 数组与函数

##二、函数的定义
c语言要求，在程序中用到的所有函数，必须“先定义，后使用”。例如想用max求两个数的最大值。必须先按规范对它进行定义，指定他的名字、函数返回类型、函数实现的功能以及参数的个数和类型，将这些信息通知给编译系统。这样程序执行max函数的时，编译系统就会按照定义式所指定的功能去执行。如果事先不定义，编译系统是无从知晓max是什么，要实现什么功能的。

对于c编译系统提供的库函数，是由编译系统事先定义好的，库文件中包含了对各函数的定义。程序设计者不必自己定义，只需要用#include指令把有关的头文件包含到本文件中即可。例如在程序中用到sqrt，fabs，sin等数学函数，就必须在文件模块开头写上：

```
#include<math.h>
```

库函数只提供了最基本、最通用的一些函数，而不可能包括人们在实际应用中所用到的所有函数。我们往往需要自己定义想要用的而库函数并没有提供的函数。

###定义无参函数
我们在9-1中的printstar和print_message函数都是无参函数，大家可以看到函数名后的括号中是空的，没有任何参数。其一般形式为

**类型名 函数名（）
{
    函数体
}**

**说明：**

（1）类型名表示的是返回值的类型，比如9-1中在定义printstar函数为
```
void printstar ()
{
    
}
```

函数没有返回值所以定义为void


###定义有参函数
一般形式为

**类型名 函数名（形式参数列表）
{
    函数体
}**

我们通过案例来理解，编写程序9-2.求出两个数的最大值。程序如下：

![Alt text](https://dn-anything-about-doc.qbox.me/c/9-5.png)


运算结果：
```
20
```

**说明**：

（1）在上述函数调用过程中，主调函数和被调函数之间存在数据传递的关系。在定义函数的时候函数名后面括号中的变量名称为“形式参数”（简称“形参”）（上例中为x和y），在调用语句`c=max(a,b);`中，a和b称为“实际参数”（简称“实参”）。

（2）函数的调用过程：
+ 在定义函数中指定的形参，在未出现函数调用时，他们并不占内存中的存储单元。在发生函数调用时，函数max的形参被临时分配内存单元。
+ 将实参对应的值传递给形参。9-2例题中，实参的值a为10，b为20.把10和20传递给相应的形参x和y，这是形参x就得到了10，形参y得到值20.
+ 在执行max函数期间，由于形参已经有值，就可以利用形参进行有关运算了
+ 通过return语句将运算得到的z的值带回主调函数。应当注意返回值的类型和函数类型一致。如max函数为int型，返回值是变量z，也是int类型，两者一致。
+ 调用结束，形参单元被释放。注意：实参单元仍保持原值和存储单元，自始至终未发生变化。形参会临时占用内存存储单元，但是实参和形参在内存中占用的存储单元是不同的。

##三、函数的嵌套调用
c语言的函数定义是互相平行、独立的，也就是说，在定义函数时，一个函数内不能定义另一个函数，也就是不能嵌套定义，但是可以嵌套调用函数，也就是说，在调用一个函数的过程中，又可以调用另一个函数。如下图：

![Alt text](https://dn-anything-about-doc.qbox.me/c/9-6.jpg)


上图的执行的过程为：
（1）执行main函数的开头部分；

（2）遇到函数调用语句，调用a函数，流程转去a函数；

（3）执行a函数的开头部分；

（4）遇到函数调用语句，调用函数b，流程专区函数b；

（5）执行b完成，返回a函数中调用b函数的位置继续执行a函数尚未执行的部分。直到a函数结束；

（6）返回main函数中调用a函数的位置，继续执行剩余的main函数部分。

####程序举例
编写程序9-3，输入四个整数，找出其中最大的整数。

**解题思路**：本题目我们就是使用函数嵌套的方法来处理。在main函数中调用max4函数，max4函数的作用是找出4个数中的最大值。在max4中调用max2函数，max2是用来找出两个数中的最大值，max4多次调用max2函数来达到找出4个数中最大值的目的。

编写程序：
```
#include<stdio.h>
int main()
{
    int max4(int a,int b,int c,int d);
    int a,b,c,d,max;
    printf("please enter 4 interger number:");
    scanf("%d%d%d%d",&a,&b,&c,&d);
    max=max4(a,b,c,d);
    printf("max=%d\n",max);
    return 0;
}

int max4(int a,int b,int c,int d)
{
    int max2(int a,int b);      //声明max2
    int m;
    m=max2(a,b);
    m=max2(m,c);
    m=max2(m,d);
    return(m);
}

int max2(int a,int b)
{
    if(a>=b)
      return a;
    else
      return b;
      
}
```

运算结果为：

![img](https://dn-anything-about-doc.qbox.me/userid8317labid367time1420507772235)

##四、函数的递归调用
递归调用：在调用一个函数的过程中又出现直接或间接的调用该函数本身，称为函数的递归调用。例如：

```
int fun(int a)
{
    int b,c;
    c=fun(b);   //在执行的过程中又调用了函数fun
    return(2*c);
}
```

在调用函数fun的过程中，又调用fun函数，这是直接调用本函数，见下图：

![img](https://dn-anything-about-doc.qbox.me/userid8317labid367time1420528652382)

这种调用都是无终止的调用，显然程序中不可能出现这种状况，而是应该出现有限次数的、有终止的递归调用，这可以用if语句来控制。

####程序举例
编写程序9-4，要求用递归的方法求n！

**解题思路：**n！=1\*2\*3\*4.......\*(n-1)\*n。采用递归的公式可表示为：

![img](https://dn-anything-about-doc.qbox.me/userid8317labid367time1420529407525)

即5！=4！\*5，而4！=3！\*4...,1!=1,具体计算过程如下：

![img](https://dn-anything-about-doc.qbox.me/userid8317labid367time1420529662753)

我们编写程序如下：

```
#include<stdio.h>
int main()
{
    int fac(int n);
    int n,y;
    printf("please input an integer number:");
    scanf("%d",&n);
    if(n<0)
      printf("date error");   //n不能小于0
    else
       {
           y=fac(n);
           printf("%d!=%d\n",n,y);
       }
    return 0;
}

int fac(int n)
{
    int f;
    if(n==0||n==1)
    f=1;
    else f=fac(n-1)*n;
    return(f);
}
```

运行结果如下：

![img](https://dn-anything-about-doc.qbox.me/userid8317labid367time1420530411684)

小编本想在这里给大家画出该程序在递归调用的版块具体的流程图，但左思右想觉得课程一直在照顾小白用户，尽量用多的图让小白能够快速理解，但这并不利于小白的学习，所以小编在此希望各位能够自己独立思考，自己画图或脑子里画图这个程序递归调用的流程图。

##五、数组与函数

###数组元素作为函数实参
数组元素可以作为函数实参，不能作为函数形参。因为形参是在函数被调用时临时分配的存储单元，不可能作为一个数组元素单独分配存储单元（数组是一个整体，在内存中占连续的一段存储单元）。在用数组元素作为函数实参时，把实参的值传给形参，是“值传递”的方式。

####程序举例
输入10个数，要求输出其中值最大的元素和该数是第几个数。

**解题思路：**可以定义一个长度为10的数组。设计一个函数max，用来求两个数中的大者。在主函数中定义一个变量m，m的初值为a[0]，每次调用max函数后的返回值存放在m中。用打擂台算法，将数组元素a[1]到a[9]与m比较，最后的到的m就是最大值。

编写程序：

```
#include<stdio.h>
int main()
{
    int max(int x,int y);
    int a[10],m,n,i;
    printf("please enter 10 integer number:");
    for(i=0;i<10;i++)
       scanf("%d",&a[i]);
    printf("\n");
    
    for(i=1,m=a[0],n=0;i<10；i++)   
    {
        if(max(m,a[i])>m)          //若max函数返回值大于m
        {
            m=max(m,a[i]);        //max函数的返回值取代m
            n=i;                  //把数组元素的序号记下来，放到n中
        }
    }
     
    printf("the largest number is %d\n it is the %dth number \n",m,n+1);
}

int max(int x,int y)
{
    return(x>y?x:y);
}
```

运行结果：

![img](https://dn-anything-about-doc.qbox.me/userid8317labid367time1420533281500)

**请注意分析怎样得到最大数是10个数中第几个数的。**

###数组名作为函数参数

除了可以用数组元素作为函数的参数外，还可以用数组名做函数参数（包括实参和形参）。应当注意的是：**用数组元素作为实参时，向形参变量传递的是数组所对应数组元素的值，而用数组名做函数实参时，向形参（数组名或指针变量）传递的是数组首元素的地址，下一节指针大家会更加深入的理解该内容**

####程序举例
编写程序9-6 有一个一位数组score，内放10个学生成绩，求平均成绩。

**解题思路：**用一个函数average来求平均成绩，不用数组元素作为函数实参，而是用数组名作为函数的实参，形参也用数组名，在average函数中引用各数组的元素，求平均成绩并返回main函数。

编写程序：
```
#include<stdio.h>
int main()
{
    float average(float array[10]);
    float score[10],aver;
    int i;
    printf("please enter 10 scores:");
    for(i=0;i<10;i++)
       scanf("%f",&score[i]);
    printf("\n");
    
    aver=average(score);   //注意这里调用函数时，向形参传递的是数组首元素的地址
    printf("average score is %5.2f\n ",aver);
    return 0;
}

float average(float array[10])
{
    int i;
    float aver,sum=0;
    for(i=0;i<10;i++)
      sum=sum+array[i];
    aver=sum/10;
    return(aver);
}
```

运行结果：

![img](https://dn-anything-about-doc.qbox.me/userid8317labid367time1420537331775)

**注意：**用数组名作为函数参数，应该在主调函数和被调用函数分别定义数组，例如array是形参的数组名，score是实参数组名，分别在其所在函数中定义。


##六、小结
该章节接触到一些重要的概念和方法，这些对于一个程序猿来讲，是必须了解和掌握的。模块化程序设计在一定规模和深度的程序设计时是必不可少的。本章只介绍了最基本的内容，希望大家能认真消化，在实验楼环境中完成每一道编程题，为以后的深入学习打下良好的基础。

##七、练习
1.编写函数fun，其功能是：将1~m能被7或11整除的所有整数放在数组a中，并通过n返回这些数的个数。
例如，如果传给m的值是50，则程序输出：
7,11,14,22,28,33,35,42,44,49

2.编写函数fun，其功能是将两个两位数的正整数a、b合并成一个整数放在c中。合并的方式是：将a数的十位和个位依次放在c数的十位和千位上，b数的十位和个位依次放在c数的百位和各位上。
例如，当a=45，b=12时，调用该函数后，c=5142.







